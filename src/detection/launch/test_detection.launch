<launch>

  <!--rviz中的fixed frame-->
  <arg name="fixed_frame" default="velodyne" />
  <!--极坐标栅格地图半径上的分割数-->
  <arg name="R" default="60" />
  <!--极坐标栅格地图角度上的分割数-->
  <arg name="TH" default="180" />
  <!--极坐标栅格地图半径上的分辨率-->
  <arg name="grid_size_r" default="0.4" />
  <!--输出栅格大小-->
  <arg name="grid_size" default="0.2" />
  <!--地面点阈值-->
  <arg name="threshold" default="0.15" />
  <!--RANSAC 阈值-->
  <arg name="RANSAC_threshold" default="0.3" />
  <!--可通行域裁剪宽度-->
  <arg name="cut_width" default="1.7" />
  <!--裁剪近处自车点x范围-->
  <arg name="cut_x" default="1.5" />
  <!--裁剪近处自车点y范围-->
  <arg name="cut_y" default="0.8" />
  <!--输出栅格地图一侧宽度-->
  <arg name="y_width" default="50" />
  <!--输出栅格地图前向长度-->
  <arg name="x_forward" default="100" />
  <!--输出栅格地图后向长度-->
  <arg name="x_backward" default="0" />
  <!--自车位置地面z坐标值-->
  <arg name="ground_z" default="-1.217" />
  <!--最大坡度阈值-->
  <arg name="max_gradient" default="0.20" />
  <!--radar x方向偏移量-->
  <arg name="x_offset" default="1.6" />
  <!--lidar ROI width-->
  <arg name="ROI_width" default="5.5" />
  <!--lidar ROI length-->
  <arg name="ROI_length" default="22.0" />

  <!--读bag文件-->
  <node pkg="rosbag" type="play" name="player" args="$(find record_data)/bagfiles/191112_f9.bag" respawn="true" />    

  <!--激光雷达地平面标定-->
  <node pkg="lidar_grid" type="lidar_calibration" name="lidar_calibration" >
    <param name="fixed_frame" value="$(arg fixed_frame)" />
    <param name="R" value="$(arg R)" />
    <param name="TH" value="$(arg TH)" />
    <param name="grid_size_r" value="$(arg grid_size_r)" />
    <param name="grid_size" value="$(arg grid_size)" />
    <param name="threshold" value="$(arg threshold)" />
    <param name="cut_x" value="$(arg cut_x)" />
    <param name="cut_y" value="$(arg cut_y)" />
    <param name="y_width" value="$(arg y_width)" />
    <param name="x_forward" value="$(arg x_forward)" />
    <param name="RANSAC_threshold" value="$(arg RANSAC_threshold)" />
  </node>

  <!--处理点云输出可通行栅格，RANSAC方法-->
  <node pkg="lidar_grid" type="lidar_grid" name="lidar_grid" >
    <param name="fixed_frame" value="$(arg fixed_frame)" />
    <param name="R" value="$(arg R)" />
    <param name="TH" value="$(arg TH)" />
    <param name="grid_size_r" value="$(arg grid_size_r)" />
    <param name="grid_size" value="$(arg grid_size)" />
    <param name="threshold" value="$(arg threshold)" />
    <param name="cut_width" value="$(arg cut_width)" />
    <param name="y_width" value="$(arg y_width)" />
    <param name="x_forward" value="$(arg x_forward)" />
    <param name="x_backward" value="$(arg x_backward)" />
    <param name="RANSAC_threshold" value="$(arg RANSAC_threshold)" />
  </node>

  <!--处理点云输出可通行栅格，梯度方法>
  <node pkg="lidar_grid" type="lidar_grid2" name="lidar_grid2" >
    <param name="fixed_frame" value="$(arg fixed_frame)" />
    <param name="R" value="$(arg R)" />
    <param name="TH" value="$(arg TH)" />
    <param name="grid_size_r" value="$(arg grid_size_r)" />
    <param name="grid_size" value="$(arg grid_size)" />
    <param name="threshold" value="$(arg threshold)" />
    <param name="ground_z" value="$(arg ground_z)" />
    <param name="max_gradient" value="$(arg max_gradient)" />
    <param name="cut_width" value="$(arg cut_width)" />
    <param name="y_width" value="$(arg y_width)" />
    <param name="x_forward" value="$(arg x_forward)" />
    <param name="x_backward" value="$(arg x_backward)" />
  </node-->  
  
  <!--激光雷达目标点云聚类-->
  <node pkg="detection" type="lidar_cluster_node" name="lidar_cluster_node" output="screen">
    <param name="fixed_frame" value="$(arg fixed_frame)" />
    <param name="ROI_width" value="$(arg ROI_width)" />
    <param name="ROI_length" value="$(arg ROI_length)" />
    <param name="cut_x" value="$(arg cut_x)" />
    <param name="cut_y" value="$(arg cut_y)" />
  </node>

  <!--接收MPC单片机CAN消息-->
  <node pkg="raw_data" type="MPC_raw_node" name="MPC_raw_node" output="screen">
    <param name="fixed_frame" value="$(arg fixed_frame)" />
    <param name="x_offset" value="$(arg x_offset)" />
  </node>

  <!--目标跟踪模块-->
  <node pkg="detection" type="tracker_node" name="tracker_node" output="screen">
    <param name="fixed_frame" value="$(arg fixed_frame)" />
    <param name="x_offset" value="$(arg x_offset)" />
  </node>

  <!--rviz可视化-->
  <node pkg="rviz" type="rviz" name="rviz" args="-d $(find detection)/rviz/detection.rviz" required="true"/>   

  <!--rqt_plot-->
  <node pkg="rqt_plot" type="rqt_plot" name="rqt_plot" />

</launch>